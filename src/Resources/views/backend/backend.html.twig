{% extends "@ContaoCore/Backend/be_page.html.twig" %}

{% block headline %}
    {% trans %}huh.pwa.backend.headline{% endtrans %}
{% endblock %}

{% block main %}
    <div class="tl_listing_container">
        <h2>Authentifizierung (VAPID-Keys)</h2>
        {% if vapidkeys|default %}
            <p>Ihre Server-VAPID-Keys zur Authentifizierung von Push-Benachrichtigungen.</p>
            {#<table class="">#}
                {#<tbody>#}
                {#<tr class="odd">#}
                    {#<td class="">Public: </td>#}
                    {#<td class="">{{ vapidkeys.publicKey }}</td>#}
                {#</tr>#}
                {#<tr class="even">#}
                    {#<td class="">Private: </td>#}
                    {#<td class="">{{ vapidkeys.privateKey }}</td>#}
                {#</tr>#}
                {#</tbody>#}
            {#</table>#}
            <p>
                Public: {{ vapidkeys.publicKey }}<br>
                Private: {{ vapidkeys.privateKey }}
            </p>
        {% else %}
            <p>Es wurden keine Schlüssel hinterlegt. Wenn Sie Web Notifications nutzen möchten, müssen Sie diese in der Konfiguration hinterlegen (Informationen dazu in der README). Sie können diese Schlüssel nutzen:</p>
            <p>
                Public: {{ generatedKeys.publicKey }}<br>
                Private: {{ generatedKeys.privateKey }}</p>
        {% endif %}

        <h2>Notifications</h2>
        <p><button id="huhPwaSendPushNotificationButton">Send unsend push notifications</button></p>
        <div id="huhPwaSendPushNotificationStatus"></div>

        <h2>Files</h2>
        <p>Rebuild manifest and serviceworker files</p>
        <p><button id="huhPwaRebuildFilesButton">Rebuild files</button></p>
        <div id="huhPwaRebuildFilesStatus"></div>

    </div>

    <script rel="script">
        window.addEvent('domready', function() {
            if (null != (sendButton = document.querySelector('#huhPwaSendPushNotificationButton')))
            {
                console.log("Found button");
                sendButton.addEventListener('click', function(event) {
                    let button = event.srcElement;
                    HuhPwaBackend.unsentCountRoute = '{{ unsentNotificationRoute }}';
                    HuhPwaBackend.sendNotificationRoute = '{{ sendNotificationRoute }}';
                    HuhPwaBackend.sendPushNotifications(button);
                })
            }
            if (null != (button = document.querySelector('#huhPwaRebuildFilesButton')))
            {
                console.log("Found button");
                button.addEventListener('click', function(event) {
                    HuhPwaBackend.findPagesRoute = '{{ findPagesRoute }}';
                    HuhPwaBackend.updatePageRoute = '{{ updatePageRoute }}';
                    HuhPwaBackend.rebuildFiles();
                })
            }
        });
    </script>
{% endblock %}